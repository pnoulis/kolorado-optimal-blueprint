#!/bin/make

##################################################
# Make config
##################################################
.DELETE_ON_ERROR:
.SECONDEXPANSION:
SHELL							:= IN_BASH
.DEFAULT_GOAL			:= all

##################################################
# App description
##################################################
PKG_AUTHOR_NAME				= IN_PKG_AUTHOR_NAME
PKG_AUTHOR_ID					= IN_PKG_AUTHOR_ID
PKG_AUTHOR_EMAIL			= IN_PKG_AUTHOR_EMAIL
PKG_AUTHOR_HOME_URL		= IN_PKG_AUTHOR_HOME_URL
PKG_NAME							= IN_PKG_NAME
PKG_ID								= IN_PKG_ID
PKG_PRETTY_NAME				= IN_PKG_PRETTY_NAME
PKG_TARNAME						= IN_PKG_TARNAME
PKG_VERSION						= IN_PKG_VERSION
PKG_VERSION_ID				= IN_PKG_VERSION_ID
PKG_VERSION_CODENAME	= IN_PKG_VERSION_CODENAME
PKG_REPOSITORY_TYPE		= IN_PKG_REPOSITORY_TYPE
PKG_REPOSITORY_DOMAIN	= IN_PKG_REPOSITORY_DOMAIN
PKG_REPONAME					= IN_PKG_REPONAME
PKG_REPOSITORY_PATH		= IN_PKG_REPOSITORY_PATH
PKG_REPOSITORY_URL		= IN_PKG_REPOSITORY_URL
PKG_HOME_URL					= IN_PKG_HOME_URL
PKG_DOCUMENTATION_URL	= IN_PKG_DOCUMENTATION_URL
PKG_BUG_REPORT_url		= IN_PKG_BUG_REPORT_URL
PKG_SUPPORT_URL				= IN_PKG_SUPPORT_URL

##################################################
# Program name transformation
##################################################
program_name					= IN_PROGRAM_NAME
program_vname					= IN_PROGRAM_VNAME

##################################################
# Build directories
##################################################
BUILDIR								= IN_BUILDIR
BUILDIR_ABS						= IN_BUILDIR_ABS
SRCDIR_TOP						= IN_SRCDIR
SRCDIR_TOP_ABS				= IN_SRCDIR_ABS
SRCDIR								= $(SRCDIR_top)/src
SRCDIR_ABS						= $(srcdir_top_abs)/src

##################################################
# Installation directories
##################################################
# gnu prefix directories
prefix								= IN_PREFIX
exec_prefix						= IN_EXEC_PREFIX
bindir								= IN_BINDIR
sbindir								= IN_SBINDIR
libexecdir						= IN_LIBEXECDIR
datarootdir						= IN_DATAROOTDIR
datadir								= IN_DATADIR
sysconfdir						= IN_SYSCONFDIR
sharedstatedir				= IN_SHAREDSTATEDIR
localstatedir					= IN_LOCALSTATEDIR
runstatedir						= IN_RUNSTATEDIR
includedir						= IN_INCLUDEDIR
oldincludedir					= IN_OLDINCLUDEDIR
docdir								= IN_DOCDIR
infodir								= IN_INFODIR
htmldir								= IN_HTMLDIR
dvidir								= IN_DVIDIR
pdfdir								= IN_PDFDIR
psdir									= IN_PSDIR
libdir								= IN_LIBDIR
localedir							= IN_LOCALEDIR
mandir								= IN_MANDIR
# Derived directories
tmpdir								= IN_TMPDIR
tmpdir_persistent			= IN_TMPDIR_PERSISTENT
statedir							= IN_STATEDIR
cachedir							= IN_CACHEDIR
logdir								= IN_LOGDIR
spooldir							= IN_SPOOLDIR
lockdir								= IN_LOCKDIR
desktopdir						= IN_DESKTOPDIR
icondir								= IN_ICONDIR
metainfodir						=	IN_METAINFODIR

##################################################
# Tools
##################################################
MAKE	= IN_MAKE
M4		= IN_M4
CHMOD	= IN_CHMOD
CHOWN	= IN_CHOWN
JQ		= IN_JQ
M4		= IN_M4
CP		= IN_CP
RM		= IN_RM
CAT		= IN_CAT

##################################################
# Important files
##################################################
MACROSFILE   = $(SRCDIR_top)/config.macros.m4
CONFIGFILE	 = $(SRCDIR_top)/configure

# Options
MODE				= IN_MODE
BASENAME		= IN_BASENAME
PORT				= IN_PORT
SERVER_URL	= IN_SERVER_URL

##################################################
# Default target
##################################################
all: build

##################################################
# Build
##################################################
build:

##################################################
# Release
##################################################
release:
	$(release)

##################################################
# Distribute
##################################################
dist: archive?=zip
dist: dist.$$(archive)

##################################################
# Package
##################################################
package: archive?=zip
package: package.$$(archive)

##################################################
# Install
##################################################
install:

##################################################
# Uninstall
##################################################
uninstall:

##################################################
# Update
##################################################
update:

##################################################
# clean
##################################################
clean:

##################################################
# distclean
##################################################
distclean: clean
	-rm -f *.log
	-rm -f .#*
	-rm -f config.*
	-rm -f Makefile

##################################################
# misc
##################################################
.DEFAULT:
	@if [ ! -f "$<" ]; then echo "Missing file -> $${file:-$<}"; exit 1; fi

##################################################
# directories
##################################################

##################################################
# help
##################################################
help:
	@cat ./Makefile | grep -i --color=auto 'phony' | cut -d ' ' -f2- | tail --lines=+3

# Software development
.PHONY: run # Read dotenvfile and run $target or tmp/scratch.js
.PHONY: build # Build application
.PHONY: test # Test application
# Software distribution
.PHONY: release # Create a new version
.PHONY: dist # Distribute source tree
.PHONY: package # Distribute build
# Software package
.PHONY: install # Install package
.PHONY: uninstall # Uninstall package
.PHONY: update # Update package
# Cleaning
.PHONY: clean # Remove files created by ./make
.PHONY: distclean # Remove files created by ./configure
# Misc
.PHONY: help # Display a short description about each Makefile target's function
.PHONY: dotenv # Write environment into .env
.PHONY: all # Default target
